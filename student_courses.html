<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>StudyBuddy – My Courses</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  /* ——— RESET & ROOT ——— */
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  :root{
    --primary:#7b68ee;
    --primary-dark:#5d50c9;
    --glass-bg:rgba(255,255,255,.14);
    --blur:16px;
  }
  html,body{height:100%;font-family:'Poppins',Arial,sans-serif;overflow:hidden;color:#fff} 

  /* ——— BG VIDEO & OVERLAY ——— */
  #bg-video{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-3}
  #bg-overlay{position:absolute;inset:0;background:linear-gradient(135deg,rgba(0,0,0,.55),rgba(0,0,0,.25));z-index:-2}

  /* ——— WATERMARK ——— */
  .watermark{
    position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-25deg);
    font-size:11vw;font-weight:900;letter-spacing:4px;
    color:rgba(255,255,255,.05);pointer-events:none;user-select:none;z-index:-1
  }

  /* ——— SIDEBAR ——— */
  .sidebar{
    height:100%;width:250px;position:fixed;top:0;left:0;padding-top:20px;
    background:var(--glass-bg);backdrop-filter:blur(var(--blur));box-shadow:4px 0 18px rgba(0,0,0,.25);
    display:flex;flex-direction:column
  }
  .profile-box{display:flex;align-items:center;color:#fff;padding:18px 22px;cursor:pointer;transition:.3s}
  .profile-box:hover{background:rgba(255,255,255,.12)}
  .profile-img{width:56px;height:56px;border-radius:50%;object-fit:cover;border:2px solid #fff;margin-right:12px}
  .sidebar-title{color:#fff;text-align:center;margin:16px 0;font-size:22px;font-weight:700;text-shadow:0 1px 3px rgba(0,0,0,.3)}
  .nav-list{list-style:none;margin-top:8px}
  .nav-link{
    display:block;padding:14px 26px;font-size:16px;font-weight:600;color:#fff;text-decoration:none;
    transition:.25s;border-left:4px solid transparent
  }
  .nav-link:hover{background:rgba(255,255,255,.15);border-left-color:#ffd700}
  .nav-link.active{background:rgba(255,255,255,.25);border-left-color:#fff}

  /* ——— CONTENT ——— */
  .content{margin-left:250px;height:100%;padding:40px 50px 60px;overflow:auto}
  .balance-box{
    position:absolute;top:40px;right:60px;padding:12px 24px;border-radius:14px;
    background:var(--glass-bg);backdrop-filter:blur(var(--blur));
    color:#0b9444;font-weight:700;box-shadow:0 2px 8px rgba(0,0,0,.25)
  }

  h1{font-size:32px;margin-bottom:14px;text-shadow:0 2px 6px rgba(0,0,0,.4)}
  p{margin-bottom:26px;color:#eee}

  /* ——— TABLE ——— */
  table{
    width:100%;border-collapse:collapse;border-radius:16px;overflow:hidden;
    background:var(--glass-bg);backdrop-filter:blur(var(--blur));
    box-shadow:0 6px 18px rgba(0,0,0,.3)
  }
  th,td{padding:16px 22px;text-align:left;border-bottom:1px solid rgba(255,255,255,.15)}
  th{background:var(--primary-dark);color:#fff;font-weight:700}
  tr:hover{background:rgba(255,255,255,.08)}
  td:last-child{text-align:center}

  /* ——— BUTTONS ——— */
  .btn-view{
    background:var(--primary);color:#fff;padding:8px 18px;border:none;border-radius:6px;
    font-size:14px;font-weight:600;cursor:pointer;transition:.25s
  }
  .btn-view:hover{transform:translateY(-2px);background:var(--primary-dark)}
  .btn-disabled{background:gray !important;cursor:not-allowed}

  /* ——— SCROLLBAR (WebKit) ——— */
  .content::-webkit-scrollbar{width:8px}
  .content::-webkit-scrollbar-thumb{background:rgba(255,255,255,.25);border-radius:4px}
</style>
</head>
<body>

<!-- BG VIDEO -->
<video id="bg-video" src="st.mp4" autoplay muted loop playsinline></video>
<div id="bg-overlay"></div>
<div class="watermark">StudyBuddy</div>

<!-- SIDEBAR -->
<div class="sidebar">
  <div class="profile-box" onclick="location='student_profile.html'">
    <img src="profile.jpg" class="profile-img" id="profileImage" alt="Profile">
    <div>
      <strong id="studentName">John Doe</strong><br>
      <span id="studentID">ID: STU12345</span>
    </div>
  </div>

  <h2 class="sidebar-title">Student Panel</h2>

   <ul class="nav-list">
      
      <li><a href="student_dashboard.html"       class="nav-link active">Dashboard</a></li>
      <li><a href="student_courses.html"         class="nav-link">My Courses</a></li>
      <li><a href="student_course_contents.html" class="nav-link">Course Contents</a></li>
      <li><a href="student_stationary.html"      class="nav-link">Stationary Shop</a></li>
      <li><a href="student_group_chat.html"      class="nav-link">Group Chat</a></li>
      <li><a href="student_notices.html"         class="nav-link">Notices</a></li>
      <li><a href="student_stationary_purchase.html" class="nav-link">Purchased Items</a></li>
      <li><a href="student_exam.html"            class="nav-link">Give Exam</a></li>
      <li><a href="media.html"                   class="nav-link">Anonymous Wall</a></li>
      <li><a href="student_login.html"           class="nav-link" onclick="logout()">Logout</a></li>
    </ul>
</div>

<!-- CONTENT -->
<div class="content">
  <div class="balance-box" id="studentBalance">Balance: 0 ৳</div>

  <h1>My Courses</h1>
  <p>Here are the available courses:</p>

  <table id="coursesTable">
    <tr>
      <th>Course Name</th>
      <th>Course Code</th>
      <th>Duration</th>
      <th>Fee (৳)</th>
      <th>Action</th>
    </tr>
  </table>
</div>

<script>
/* ——— USER SESSION ——— */
const student = JSON.parse(localStorage.getItem('student'));
if(!student){
  alert("You must log in first.");location='student_login.html';
}else{
  studentName.textContent = student.name;
  studentID.textContent   = "ID: "+student.id;
  studentBalance.textContent = "Balance: "+student.balance+" ৳";
  profileImage.src = student.profile_image?.startsWith('uploads/')
    ? 'http://localhost:3000/'+student.profile_image
    : (student.profile_image||'profile.jpg');
}
function logout(){localStorage.removeItem('student');location='student_login.html';}

/* ——— LOAD COURSES ——— */
async function loadCourses(){
  try{
    const all = await (await fetch('http://localhost:3000/get-courses')).json();
    const mine= await (await fetch(`http://localhost:3000/get-my-courses?student_id=${student.id}`)).json();
    const owned = new Set(mine.map(c=>c.id));
    const table = document.getElementById('coursesTable');

    all.forEach(c=>{
      const row=document.createElement('tr');
      const bought=owned.has(c.id);
      row.innerHTML=`
        <td>${c.course_name}</td>
        <td>${c.course_code}</td>
        <td>${c.duration} weeks</td>
        <td>${c.balance} ৳</td>
        <td>${bought
            ?'<button class="btn-view btn-disabled" disabled>Purchased</button>'
            :`<button class="btn-view" onclick="buyCourse(${c.id},this)">Buy</button>`}
        </td>`;
      table.appendChild(row);
    });
  }catch(err){console.error(err);alert('Error loading courses.');}
}

/* ——— BUY COURSE ——— */
function buyCourse(id,btn){
  fetch('http://localhost:3000/buy-course',{
    method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({student_id:student.id,course_id:id})
  })
  .then(r=>r.json()).then(d=>{
    alert(d.message);
    if(d.success){
      student.balance=d.updatedBalance;
      localStorage.setItem('student',JSON.stringify(student));
      studentBalance.textContent="Balance: "+student.balance+" ৳";
      btn.textContent='Purchased';btn.disabled=true;btn.classList.add('btn-disabled');
    }
  }).catch(err=>console.error(err));
}

loadCourses();
</script>
</body>
</html>
